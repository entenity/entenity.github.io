(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{373:function(n,e,a){"use strict";a.r(e);var t=a(26),r=Object(t.a)({},(function(){var n=this,e=n.$createElement,a=n._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[a("p",[n._v("本文为慕课网 "),a("a",{attrs:{href:"http://www.imooc.com/learn/277",target:"_blank",rel:"noopener noreferrer"}},[n._v("JavaScript深入浅出"),a("OutboundLink")],1),n._v(" JavaScript 中的闭包笔记。")]),n._v(" "),a("h2",{attrs:{id:"闭包的例子"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#闭包的例子"}},[n._v("#")]),n._v(" 闭包的例子")]),n._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[n._v("function outer() {\n    var localVal = 30;\n    return localVal;\n}\n\nconsole.log(outer()); //30\n\nfunction outer2() {\n    var localVal = 30;\n    return function() {\n        return localVal;\n    };\n}\n\nvar func = outer2();\nconsole.log(func()); //30\n")])])]),a("p",[n._v("对于第一个普通的函数，在执行过之后，它的局部变量就可以被释放。")]),n._v(" "),a("p",[n._v("对于第二个函数，"),a("code",[n._v("localVal")]),n._v(" 是不能被释放的。因为调用 "),a("code",[n._v("outer2()")]),n._v(" 后，返回的是匿名函数，匿名函数可以访问外部的 "),a("code",[n._v("outer2()")]),n._v(" 中的局部变量，并返回了这个局部变量 localVal。当 "),a("code",[n._v("outer2()")]),n._v(" 赋值给 "),a("code",[n._v("func")]),n._v(" 后，再次调用 "),a("code",[n._v("func()")]),n._v("，仍能访问到局部变量 "),a("code",[n._v("localVal")]),n._v("。这种情况就是闭包。")]),n._v(" "),a("hr"),n._v(" "),a("h2",{attrs:{id:"应用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#应用"}},[n._v("#")]),n._v(" 应用")]),n._v(" "),a("ul",[a("li",[a("p",[a("strong",[n._v("所谓闭包就是：子函数可以使用父函数中的局部变量。")])]),n._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[n._v('  ! function() {\n      var localData = "localData here";\n      document.addEventListener(\'click\',\n          function() {\n              console.log(localData); //这里访问外部数据\n          });\n  }();\n\n  ! function() {\n      var localData = "localData here";\n      var url = "http://www.baidu.com/";\n      $.ajax({\n          url: url,\n          success: function() {\n              // do sth...\n              console.log(localData); //这里访问外部数据\n          }\n      });\n  }()\n')])])])])]),n._v(" "),a("hr"),n._v(" "),a("h2",{attrs:{id:"常见错误之循环闭包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#常见错误之循环闭包"}},[n._v("#")]),n._v(" 常见错误之循环闭包")]),n._v(" "),a("p",[n._v("比如我们想循环绑定点击事件")]),n._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[n._v("document.body.innerHTML = \"<div id=div1>aaa</div><div id=div2>bbb</div><div id=div3>ccc</div>\";\nfor (var i = 1; i < 4; i++) {\n    document.getElementById('div' + i).\n    addEventListener('click', function() {\n        alert(i); // all are 4!\n    });\n}\n")])])]),a("p",[n._v("上面的代码，我们点击任何一个 div，弹出的都是 4")]),n._v(" "),a("p",[n._v("这是因为，for 循环中的 i 是一个全局变量。这里内函数的点击事件，访问到的是循环后的 i 值，所以是 4")]),n._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[n._v("document.body.innerHTML = \"<div id=div1>aaa</div><div id=div2>bbb</div><div id=div3>ccc</div>\";\nfor (var i = 1; i < 4; i++) {\n    ! function(i) {\n        document.getElementById('div' + i).\n        addEventListener('click', function() {\n            alert(i); // 1, 2, 3\n        });\n    }(i);\n}\n")])])]),a("p",[n._v("这里使用了立即执行函数，并给匿名函数赋值 i，这样点击事件每一次就会访问到相应的 i。")]),n._v(" "),a("hr"),n._v(" "),a("h2",{attrs:{id:"封装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#封装"}},[n._v("#")]),n._v(" 封装")]),n._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[n._v('(function() {\n    var _userId = 9527;\n    var _typeId = "item";\n    var exp = {};\n\n    function converter(userId) {\n        return +userId;\n    }\n\n    exp.getUserId = function() {\n        return converter(_userId);\n    };\n\n    exp.getTypeId = function() {\n        return _typeId;\n    };\n\n    window.a = exp;\n})();\n\nconsole.log(a.getUserId()); //9527\nconsole.log(a.getTypeId()); //item\n\nconsole.log(a._userId); //undefined\nconsole.log(a._typeId); //undefined\nconsole.log(converter); //Uncaught ReferenceError: converter is not defined\n')])])]),a("p",[n._v("上面的代码通过闭包实现了一个封装。")]),n._v(" "),a("hr"),n._v(" "),a("h2",{attrs:{id:"总结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[n._v("#")]),n._v(" 总结")]),n._v(" "),a("blockquote",[a("ul",[a("li",[a("p",[n._v("在计算机科学中，闭包（也称词法闭包或函数闭包）是指一个函数或函数的引用，与一个引用环境绑定在一起。这个引用环境是一个存储该函数每个非局部变量（也叫自由变量）的表。")])]),n._v(" "),a("li",[a("p",[n._v("闭包，不同于一般的函数，它允许一个函数在立即词法作用域外调用时，仍可访问非本地变量。")])])]),n._v(" "),a("p",[n._v("from 维基百科")])]),n._v(" "),a("ul",[a("li",[a("p",[n._v("闭包的优点")]),n._v(" "),a("ul",[a("li",[n._v("灵活和方便")]),n._v(" "),a("li",[n._v("封装")])])]),n._v(" "),a("li",[a("p",[n._v("缺点")]),n._v(" "),a("ul",[a("li",[n._v("空间浪费")]),n._v(" "),a("li",[n._v("内存泄露")]),n._v(" "),a("li",[n._v("性能消耗")])])])])])}),[],!1,null,null,null);e.default=r.exports}}]);